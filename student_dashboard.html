<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Student Dashboard</title>
  
  <!-- Standard favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#003366">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Student Dashboard">
  <meta name="application-name" content="Student Dashboard">
  <meta name="msapplication-TileColor" content="#003366">
  <meta name="msapplication-config" content="browserconfig.xml">
  
  <!-- Enhanced Mobile Support -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="Logo2.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="Logo2.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="Logo2.jpg">
  
  <!-- Splash Screen Meta -->
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <!-- External Stylesheets -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="student.css">
  <link rel="stylesheet" href="assignments.css">
</head>
<body>
  <div class="dashboard">
    <!-- Sidebar Navigation -->
    <nav>
      <div class="logo-container">
        <img src="Logo2.jpg" alt="Student Portal Logo" class="logo">
        <h1 class="heading">STUDENT</h1>
      </div>
      
      <ul id="main-nav">
        <li><a href="#" data-section="assignments" class="active"><i class="fas fa-book"></i> Assignments</a></li>
        <li><a href="#" data-section="course-registration"><i class="fas fa-clipboard-list"></i> Registration</a></li>
        <li><a href="#" data-section="notifications"><i class="fas fa-bell"></i> Notifications</a></li>
        <li><a href="#" data-section="profile"><i class="fas fa-user"></i> Profile</a></li>
        <li><a href="login.html" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
      </ul>
      
      <div class="hamburger-menu" id="hamburger-menu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </nav>
    
    <!-- Main Content -->
    <main>
      <!-- Assignments Section -->
      <section id="assignments" class="active">
        <h2>Assignments</h2>
        <div class="assignments-wrapper">
          <div class="assignment-filters">
            <button class="filter-tab active" data-filter="all">All</button>
            <button class="filter-tab" data-filter="overdue">Overdue</button>
            <button class="filter-tab" data-filter="not-submitted">Not Submitted</button>
            <button class="filter-tab" data-filter="graded">Graded</button>
          </div>
          <div class="assignments-grid">
            <!-- Assignments will be loaded dynamically from API -->
          </div>
        </div>
      </section> 
      
      <!-- Course Registration Section -->
      <section id="course-registration">
        <h2>Course Registration</h2>
        <div class="registration-container">
          <div class="card registration-form-card">
            <h3>Register for Courses</h3>
            <div id="loading-courses" class="loading-message" style="display: none;">
              <i class="fas fa-spinner fa-spin"></i> Loading available courses...
            </div>
            <form id="register-course-form">
              <div class="student-level-info">
                <p><strong>Your Current Level:</strong> <span id="student-current-level">Loading...</span></p>
              </div>
              
              <div class="form-row" style="display: none;">
                <div class="form-group">
                  <label for="level">Academic Level:</label>
                  <select id="level">
                    <option value="">Select Level</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="semester">Semester:</label>
                  <select id="semester">
                    <option value="">Select Semester</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="course-select">Available Courses:</label>
                <div class="custom-select">
                  <select id="course-select" multiple size="8" required>
                    <option value="" disabled>Please select level and semester first</option>
                  </select>
                  <div class="select-actions">
                    <button type="button" class="select-all-btn">Select All</button>
                    <button type="button" class="clear-selection-btn">Clear</button>
                  </div>
                </div>
                <p class="hint">Hold Ctrl/Cmd to select multiple courses</p>
                <div class="course-info-display" style="display: none;">
                  <p class="selected-count">Selected: <span>0</span> courses</p>
                  <p class="total-credits">Total Credits: <span>0</span></p>
                </div>
              </div>
              
              <button type="submit" class="submit-btn" disabled>
                <i class="fas fa-save"></i> Register Selected Courses
              </button>
            </form>
          </div>
        </div>
      </section> 
      
      <!-- Notifications Section -->
      <section id="notifications">
        <h2>Notifications</h2>
        
        <div class="notification-actions">
          <button id="mark-all-read" class="action-btn">
            <i class="fas fa-check-double"></i> Mark All as Read
          </button>
          <button id="clear-notifications" class="action-btn">
            <i class="fas fa-trash"></i> Clear All
          </button>
          <div class="notification-filter">
            <select id="notification-type-filter" title="Filter notifications by type">
              <option value="all">All Types</option>
              <option value="assignment">Assignments</option>
              <option value="quiz">Quizzes</option>
              <option value="course">Course Updates</option>
              <option value="system">System</option>
            </select>
          </div>
        </div>
        
        <div class="card">
          <div class="notification-category">
            <h3><i class="fas fa-bell"></i> All Notifications</h3>
            <ul class="notification-list">
              <!-- Notifications will be loaded dynamically from API -->
            </ul>
          </div>
          
          <div class="notification-stats">
            <div class="stat-item">
              <i class="fas fa-envelope"></i>
              <span><strong>Unread:</strong> 0</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-calendar-week"></i>
              <span><strong>This Week:</strong> 0</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-archive"></i>
              <span><strong>Total:</strong> 0</span>
            </div>
          </div>
        </div>
      </section> 
      
      <!-- Profile Section -->
      <section id="profile">
        <h2>My Profile</h2>
        
        <div class="profile-container">
          <div class="card profile-card">
            <div class="profile-header">
              <div class="profile-info">
                <!-- Profile information will be loaded from API -->
              </div>
            </div>
            
            <div class="profile-details">
              <div class="detail-section">
                <h4><i class="fas fa-user-graduate"></i> Academic Information</h4>
                <ul>
                  <!-- Academic information will be loaded from API -->
                </ul>
              </div>
              
              <div class="profile-actions">
                <button id="changePasswordBtn" class="submit-btn">
                  <i class="fas fa-key"></i> Change Password
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
  
  <!-- Upload Modal -->
  <div id="upload-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Submit Assignment</h3>
      <form id="assignment-upload-form">
        <div class="form-group">
          <label for="assignment-file">Select file to upload:</label>
          <input type="file" id="assignment-file" required>
        </div>
        <div class="form-group">
          <label for="assignment-comments">Additional Comments:</label>
          <textarea id="assignment-comments" rows="4"></textarea>
        </div>
        <button type="submit" class="submit-btn">Submit Assignment</button>
      </form>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div id="feedback-modal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h3>Assignment Feedback</h3>
      <div class="feedback-content">
        <h4>Neural Network Assignment</h4>
        <p><strong>Grade:</strong> B+</p>
        <p><strong>Lecturer's Comments:</strong></p>
        <div class="comments">
          <p>Good work overall. Your implementation was correct but could benefit from more detailed documentation. 
          The activation function choice was appropriate but consider experimenting with others in future projects.</p>
        </div>
      </div>
    </div>
  </div>
  
  <script src="student_dashboard.js"></script>
  
  <!-- PWA Installation and Service Worker Registration -->
  <script>
    // Check if browser supports Service Workers
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then((registration) => {
            console.log('Service Worker registered successfully:', registration.scope);
          })
          .catch((error) => {
            console.error('Service Worker registration failed:', error);
          });
      });
    }

    // PWA Install Prompt
    let deferredPrompt;
    let installButton = null;

    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent the mini-infobar from appearing on mobile
      e.preventDefault();
      // Stash the event so it can be triggered later
      deferredPrompt = e;
      // Show install button/banner
      showInstallPrompt();
    });

    function showInstallPrompt() {
      // Create install button if it doesn't exist
      if (!installButton) {
        installButton = document.createElement('button');
        installButton.textContent = 'ðŸ“± Install App';
        installButton.className = 'install-btn';
        installButton.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #003366;
          color: white;
          border: none;
          padding: 10px 15px;
          border-radius: 5px;
          cursor: pointer;
          font-size: 14px;
          z-index: 1000;
          box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        `;
        installButton.addEventListener('click', installApp);
        document.body.appendChild(installButton);
      }
      installButton.style.display = 'block';
    }

    async function installApp() {
      if (deferredPrompt) {
        // Show the install prompt
        deferredPrompt.prompt();
        // Wait for the user's response
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`User response to install prompt: ${outcome}`);
        // Clear the saved prompt since it can't be used again
        deferredPrompt = null;
        // Hide the install button
        if (installButton) {
          installButton.style.display = 'none';
        }
      }
    }

    // Handle successful app installation
    window.addEventListener('appinstalled', (e) => {
      console.log('PWA was installed successfully');
      if (installButton) {
        installButton.style.display = 'none';
      }
    });

    // Add to home screen for iOS
    if (window.navigator.standalone === false) {
      // Not installed, show iOS install instructions if on iOS
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
      if (isIOS) {
        setTimeout(() => {
          if (!document.querySelector('.ios-install-prompt')) {
            const iosPrompt = document.createElement('div');
            iosPrompt.className = 'ios-install-prompt';
            iosPrompt.innerHTML = `
              <div style="position: fixed; bottom: 20px; left: 20px; right: 20px; background: #003366; color: white; padding: 15px; border-radius: 8px; text-align: center; z-index: 1000;">
                ðŸ“± Install this app: Tap the share button <i class="fas fa-share"></i> and then "Add to Home Screen"
                <button onclick="this.parentElement.parentElement.remove()" style="float: right; background: none; border: none; color: white; font-size: 18px; cursor: pointer;">&times;</button>
              </div>
            `;
            document.body.appendChild(iosPrompt);
          }
        }, 3000);
      }
    }
  </script>
</body>
</html>
